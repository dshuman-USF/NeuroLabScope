\input texinfo   @c -*-texinfo-*-
@c %**start of header
@setfilename scope.info
@settitle USF Scope
@c %**end of header
     
@copying

Copyright (C) 2007 Bruce G. Lindsey
@end copying

@ifinfo
@dircategory Scientific software

@direntry
* scope: (scope).       USF Scope
@end direntry

@end ifinfo

@titlepage
@title USF Scope
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage

@contents
     
@ifnottex
@node Top, New Features in Version 1.9.6, (dir), (dir)
@top USF Scope
@end ifnottex

@menu
* New Features in Version 1.9.6::  
* Overview::                    
* The Edit Menu::               
* The Options Menu::            
* The Slider::                  
* File Structure::              
* References::                  
@end menu

@node New Features in Version 1.9.6, Overview, Top, Top
@chapter New Features in Version 1.9.6

@itemize
@item
``Save Surrogates'' on the bandpass dialog. @xref{Save Surrogates}.
@item
``Left Ticks'' on the Options menu. @xref{Left Ticks}.
@item
Bug fix: bandpass threshold in Log and Thr mode has been corrected.
@end itemize

@node Overview, The Edit Menu, New Features in Version 1.9.6, Top
@chapter Overview

Typically, before the files generated by a spike sorter system can be
analyzed they must be read, displayed, annotated, selected, and
saved. This document describes the program
@command{Scope}@footnote{The initial version of this program was named
@command{Xscope} (Lindsey et al., 1992). The program was developed in
laboratory of B. G. Lindsey at the University of South Florida by Jim
Miller, Peter R. Barnhill and others using the K&R C language,
X-windows and Motif. The latest version was modified and enhanced as
described in this document by Russell O'Connor in
2006-2007. Development of the program was supported by NIH grants
NS19814 and NS46062 as part of the NSF/NIH Collaborative Research in
Computational Neuroscience Program.}, a spike train analysis utility
program to visualize the times of action potentials in simultaneously
monitored neurons, other event timing pulse codes, and associated
analog signal. The program can scan, edit, select and save sections of
the files generated by a spike ``sorting'' system for subsequent
analyses.

The program provides traditional representations such as firing rate
histograms and rectified and filtered (``integrated'') records, and
has tools to add time marker ``codes'' and delete or select sections
of the data for subsequent analysis (e.g., results from a particular
stimulus protocol).

@float Figure,The Scope Screen
@image{scopescreen,5in}

@caption{a representative snapshot with histograms of action potential
firing rates of eight simultaneously monitored neurons. Timing pulse
codes marking the onset of inspiration and expiration derived from
analog trace 1 showing integrated phrenic activity are also
included. Analog trace 2 shows arterial blood pressure.  }
@end float

@menu
* Features::                    
@end menu

@node Features,  , Overview, Overview
@section Features

@itemize
@item
Accurate display of both spike train occurrence times and associated
signals recorded in multiple formats with varying time resolutions.
@item
Accurate synchronization and display of original analog channel
recordings and spike sorter output files.
@item
Support for multiple time resolutions of spike train data to allow for
the continued increase in sampling speeds of data acquisition systems.
@item
The ability to "slide" or "jump" to different locations in the file.
@item
The ability to insert new codes by mouse click, automatically at
regular intervals, or to indicate cycle phase transitions in analog
signals (e.g., onset of a respiratory phase or cardiac cycle).
@item
The ability to delete or select and write channels and/or time slices
to separate files.
@item
Simple search routines to find a particular event on a channel by time
or event count.
@item
The ability to display an event count for each channel of spike train
data.
@item
Display a simple firing rate histogram for the spike train data with a
choice of single channel or global scaling.
@item
Display an integrated or moving average representation of spike train
firing rate data.
@item
Display bandpass filtered spike trains and analog signals with tests
of significance for signals in the band.

@end itemize


@node The Edit Menu, The Options Menu, Overview, Top
@chapter The Edit Menu

@menu
* Add a code::                  
* Set Filters::                 
* Write::                       
@end menu

@node Add a code, Set Filters, The Edit Menu, The Edit Menu
@section Add a code

@menu
* Manual::                      
* Periodic::                    
* Offset::                      
@end menu

@node Manual, Periodic, Add a code, Add a code
@subsection Manual

Add a new code by mouse click.

@node Periodic, Offset, Manual, Add a code
@subsection Periodic

Add a new code at regular intervals.

@node Offset,  , Periodic, Add a code
@subsection Offset

Add a new code that repeats existing code, but with each event offset.

@node Set Filters, Write, Add a code, The Edit Menu
@section Set Filters

Allows user to ``mark'' sections of the data with the mouse for
``passing'' to another file or deleting from the file to be written
out. In auto mode a particular event code is used to define the
beginning of blocks to be selected. In either mode markB code 21 and
markE code 22 can be added to the beginning and end of each selected
block respectively. Some programs need such identifiers.

@node Write,  , Set Filters, The Edit Menu
@section Write

Writes out the selected stuff and/or the file without the 'deleted'
stuff.  Any line can be deleted at write by clicking the box to the
left of each line.


@node The Options Menu, The Slider, The Edit Menu, Top
@chapter The Options Menu

@menu
* Scale::                       
* Tally::                       
* Histogram::                   
* Integrate::                   
* Bandpass::                    
* Find..::                      
* Left Ticks::                  
@end menu

@node Scale, Tally, The Options Menu, The Options Menu
@section Scale

Set the time span displayed in seconds.

@node Tally, Histogram, Scale, The Options Menu
@section Tally

Display the number of events with each id.

@node Histogram, Integrate, Tally, The Options Menu
@section Histogram

Display rate histograms for each row of events.

@node Integrate, Bandpass, Histogram, The Options Menu
@section Integrate

Display leaky integration of events in each row.

@page

@node Bandpass, Find.., Integrate, The Options Menu
@section Bandpass

Display bandpass filtered events or analog data in each row.

A sampled signal is generated from the spike-time data as follows:

First, a sampling frequency is chosen that is four times the upper
limit of the pass band.  Then, the value of each sample at this
frequency is calculated as the number of spikes that occurred during
that sample interval.

This signal is generated to cover the displayed portion of the signal
plus 10% (to avoid edge effects) plus as much more as is necessary so
that the number of samples has no factor larger than 7 (so the FFT
will be quick).

Then the FFT of the signal is calculated, the frequency bins outside
the passband are set to zero, and the inverse FFT is calculated.  The
result is what is displayed when the Display Format is set to "Norm".

@float Figure,The Bandpass Filter Dialog
@image{bandpass,1.8in}
@caption{The bandpass filter dialog.}
@end float

@menu
* Breaths per minute::          
* Normalization::               
* Display Format::              
* Surrogate Count::             
* Threshold Distribution::      
* Threshold Level::             
* Empirical Distribution Histogram::  
* Save Surrogates::             
* Color::                       
@end menu

@node Breaths per minute, Normalization, Bandpass, Bandpass
@subsection Breaths per minute

The pass band is specified in breaths per minute because the filter is
traditionally used on respiratory data.

@node Normalization, Display Format, Breaths per minute, Bandpass
@subsection Normalization
@itemize
@item Local Normalization: each trace is scaled so that the largest
displayed amplitude of that trace just fits in the available space.
@item Global Normalization: each trace is scaled so that the largest
displayed amplitude of the trace with the largest amplitude just fits
in the available space, and the rest use the same scale.
@end itemize
Normalization does not apply to the threshold display.

@node Display Format, Surrogate Count, Normalization, Bandpass
@subsection Display Format

@itemize 
@item Norm: filtered data is displayed.
@item Log: the log of the envelope of the filtered data is displayed.
This is one value per cycle of the filtered signal.  The zero of this
display is the threshold level.

@item Env: the  envelope of the filtered data is displayed.
This is one value per cycle of the filtered signal.
@item Thr: the display is either full scale or zero depending on whether
the envelope is above or below the threshold.  This is the same
threshold used in the Log display.
@end itemize

@node Surrogate Count, Threshold Distribution, Display Format, Bandpass
@subsection Surrogate Count

This option selects the number of surrogate spike trains used in
calculating the threshold level.  Even if the firing rate of the spike
train has no content in the pass band, the spike train itself will
have some content in the pass band due to the random component of the
spike times.  We estimate this minimal level of content to use as a
threshold by generating surrogate spike trains from the firing rate of
the original spike train with the pass band filtered out, and then
filtering the surrogate spike trains with the normal bandpass filter,
and then using the distribution of the envelope values (one per cycle)
to set the threshold.  If one surrogate doesn't generate enough
envelope values, the user can choose 20 or 100.

@node Threshold Distribution, Threshold Level, Surrogate Count, Bandpass
@subsection Threshold Distribution

@itemize
@item Normal: with this setting, the threshold is based on the mean and standard
deviation of the log of the envelope values of the filtered surrogate
spike trains (since the envelope value cannot be less that zero, the
log of the value gives a more nearly normal distribution).
@item Empirical: with this setting, the threshold is based on quantiles of the actual
envelope values of filtered surrogate spike trains
@end itemize

@node Threshold Level, Empirical Distribution Histogram, Threshold Distribution, Bandpass
@subsection Threshold Level

@itemize
@item 01: the threshold is set to 2.3263 standard deviations below
the mean, or the .01 quantile (1st percentile).  This setting is
appropriate to give high confidence that there is no content in the
pass band.
@item 05: the threshold is set to 1.6449 standard deviations below
the mean, or the .05 quantile (5th percentile).
@item 50: the threshold is set to the mean, or the .5 quantile (50th
percentile). 
@item 95: the threshold is set to 1.6449 standard deviations above
the mean, or the .95 quantile (95th percentile).
@item 99: the threshold is set to 2.3263 standard deviations above
the mean, or the .99 quantile (99th percentile).  This setting is
appropriate to give high confidence that there is content in the pass
band.
@end itemize

@node Empirical Distribution Histogram, Save Surrogates, Threshold Level, Bandpass
@subsection Empirical Distribution Histogram

If this option is set to ``On'', a histogram of the envelope values of
the filtered surrogate spike trains will be displayed.  This feature
only works in ``Log'' or ``Thr'' Display Format.  Also, it requires
the applications ``gv'' and either ``octave'' or
Matlab@registeredsymbol{} to be installed on the system. (The programs
``gv'' and ``octave'' are not part of this package, but are available
free of charge on most Linux systems.)  Matlab@registeredsymbol{} will
not be used unless the environment variable USE_MATLAB is set, which
can be done by invoking scope as
@example
USE_MATLAB=1 scope
@end example

@node Save Surrogates, Color, Empirical Distribution Histogram, Bandpass
@subsection Save Surrogates

If this option is set to ``On'', the surrogate spike trains that are
generated by a bandpass in Log or Env Display Format (@pxref{Display
Format}) are written to files named ``control_NNN.edt'' in the current
directory.  There is one file for each displayed digital channel --
NNN is the channel id.  The first channel in the control_NNN.edt file
is the original channel, and the rest are the surrogates.  Only the
displayed portion plus a little extra is saved to the control_NNN.edt
file.  The saved portion is the portion on which the filtering was
done.  If you open a control_NNN.edt file in @command{scope} and apply
the same bandpass filter (but with global normalization
(@pxref{Normalization})) as the one that generated the file, you can
see the relative effect of the filter on the original trace and the
surrogates.  In order to reproduce the original results, you must set
the Left Time (@pxref{Left Ticks} and the Scale (@pxref{Scale}) to the
same values that they had when the filter was run that generated the
file.

@node Color,  , Save Surrogates, Bandpass
@subsection Color

Unless this option is set to ``Off'', the bandpass values to be plotted
will be displayed encoded into colors, rather than plotted as a line
or bar graph.  A variety of different color encodings is offered.  The
appropriate spectrum is displayed in the selection box when a color
option is chosen, serving as a key for the display.

@node Find.., Left Ticks, Bandpass, The Options Menu
@section Find..

Find the nth occurrence of an event code.  After being found, it will
be the left most of that event displayed.

@node Left Ticks,  , Find.., The Options Menu
@section Left Ticks

Display and set the ``Screen Left'' position in ticks.  This is done
in units of ticks (.5 ms for .bdt files, .1 ms for .edt files),
because that is how it is stored internally.  This allows you to
determine or set it exactly.  This is useful, for example, if you save
the bandpass surrogates and you want to open them in another
@command{scope} and compare the bandpass results (@pxref{Save
Surrogates}).

@node The Slider, File Structure, The Options Menu, Top
@chapter The Slider

To scroll through time click on left or right arrow heads.  Each click
moves a few pixels.  The arrows will repeat if held down, for a
relatively smooth scroll.  To move to a different place in the file,
drag the slider.  Clicking in the slider track will move a screen at
at time.

@node File Structure, References, The Slider, Top
@chapter File Structure

@command{Scope} reads and writes analog and spike data from three file
types: .adt, .bdt, and .edt.  All three are @acronym{ASCII} files with
the id (and maybe analog value) in the first column, and the time in
the second column.

@menu
* .adt Files::                  
* .bdt Files::                  
* .edt Files::                  
@end menu

@node .adt Files, .bdt Files, File Structure, File Structure
@section .adt Files

Each line is I2,I8 where I2 is the spike (or other event) code and I8
is clock counts in 0.5 msec. resolution.

@node .bdt Files, .edt Files, .adt Files, File Structure
@section .bdt Files

Each line is I5,I8 where I5 is the event code and I8 is clock counts
in 0.5 msec. resolution. If I5 is > 1000, then the I5 contains both
the voltage and channel identifier. The right 12 bits are the voltage
in 2's complement. The left 4 bits are the ``analog channel
number''. This format was initially developed for use on a PDP11.

@node .edt Files,  , .bdt Files, File Structure
@section .edt Files

Each line is I5,I10 where I5 is the event code and I8 is clock counts
in 0.1 msec. resolution. If I5 is > 1000, then the I5 contains both
the voltage and channel identifier. The right 12 bits are the voltage
in 2's complement. The left 4 bits are the ``analog channel
number''. This format was initially developed for use on a @sc{PDP11}.


@node References,  , File Structure, Top
@chapter References

@itemize @bullet
@anchor{Lindsey et al. 1992}Lindsey, B. G., Hernandez, Y. M., Morris,
K. F., Shannon, R., and Gerstein, G. L. Dynamic reconfiguration of
brain stem neural assemblies: Respiratory phase-dependent synchrony
versus modulation of firing rates. @b{Journal of Neurophysiology} 67:
923-930, 1992.

@end itemize

@bye
