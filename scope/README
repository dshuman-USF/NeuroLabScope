THE BANDPASS FILTER OPTION
==========================

The Bandpass item on the Options menu will apply a bandpass filter to
the displayed portion of the displayed digital channels.  The upper
and lower limits of the filter can be selected in the dialog box.
They default to 60 breaths per minute and 5 breaths per minute.

In order for the input data to include all frequencies up to the upper
limit of the band, the input data has to be sampled at a frequency
that is at least twice the upper limit of the band.  The algorithm in
the bandpass option samples at four times the upper limit of the
band.  Each sample is the number of spikes that occurred during that
sample interval.

Normalization
-------------

Each waveform is displayed so that the minimum value is at the bottom
of the available space and the maximum value is at the top.  The
minimum and maximum values can be calculated in one of the following
two ways:

Global: The minimum or maximum value for each trace is the minimum or
        maximum value for the displayed portion of all the displayed
        traces.

Local:  The minimum or maximum value for each trace is the minimum or
        maximum value for the displayed portion of that trace.

If the minimum value is equal to the maximum value, and the value is
greater than zero, the trace is displayed at the top of the available
space.

If the minimum value is equal to the maximum value, and the value is
less than or equal to zero, the trace is displayed at the bottom of
the available space.

The available space is 70% of the distance between the baselines of
adjacent traces.

Display Format
--------------

Norm: The filtered waveform is displayed unaltered.

Log:  The displayed waveform is the logarithm of the ratio between the
      envelope (see below) of the filtered waveform and the threshold
      (see below) value.

Env:  The displayed waveform is the envelope of the filtered waveform.
      The envelope value is constant between negative going zero
      crossings of the filtered waveform, and is the absolute value of
      the peak positive or negative amplitude of the filtered waveform
      between the zero crossings.

Thr:  The displayed waveform is 1 or 0 at each sample, depending on
      whether the the envelope is above or below the threshold,
      respectively.


Threshold Level
---------------

The Log and Thr display formats use a threshold.  The threshold is
calculated by generating, for each trace, a random spike train with
the same apparent refractory period and firing rate as the original
spike train, for the displayed portion of the trace.  The random spike
train is then filtered the same way as the original spike train, and
the envelope calculated as described above.  There are then three
choices for the resulting threshold:

Min: The threshold is the minimum value of the envelope.

Avg: The threshold is the value of the envelope averaged over cycles,
     where each cycle is the interval between negative going zero
     crossings of the filtered random spike train.

Max: The threshold is the maximum value of the envelope.

The "apparent refractory period" is the minimum inter-spike interval
(ISI) in the displayed portion of the original spike train.  The
firing rate is the number of spikes in the displayed portion of the
original spike train, divided by the duration of the the displayed
portion minus the number of spikes time the minimum ISI.

For the random spike train, the probability of a spike in any sample
interval during the refractory period is zero.  The probability (p) of
a spike in any sample interval after the refractory period and before
the next spike is the firing rate times the duration of the sample
interval.  So for the intervals during which the probability is p, the
random spike train is a Bernoulli process.  The intervals between
spikes for a Bernoulli process have a geometric distribution.

If u is a (uniformly distributed) random number between 0 and 1,
int(log(u)/log(1-p)) will be a random integer with a geometric
distribution corresponding to the number of trials between successes
with a probability p of success per trial.  (From the source code of
the gsl_ran_geometric function of the Gnu Scientific Library.)

So the random spike train is generated by repeated applications of the
equation 

        ISI = min_ISI + log (u) / log (1 - p)
